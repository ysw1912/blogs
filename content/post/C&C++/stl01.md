---
author: "ysw1912"
date: 2018-06-07T10:00:00+08:00
lastmod: 2018-06-07T10:00:00+08:00
title: "红黑树删除节点"
tags: [
    "数据结构",
    "C/C++"
]
categories: [
    "数据结构"
]
---

## 红黑树

&ensp;&ensp;红黑树是一种自平衡的二叉查找树（BST），可在`O(logN)`时间内完成查找、插入、删除等操作。

&ensp;&ensp;鉴于插入操作比较容易理解，这里只重点描述删除节点的操作。

## 红黑树性质

&ensp;&ensp;红黑树通过如下规则，控制任意节点的左右子树高度差，以实现自平衡：

1. 节点是红色或黑色。
2. 根节点为黑色。
3. 如果节点为红，其子节点必须为黑（每个叶节点到根节点所有路径上不能有两个连续的红色节点）。
4. 任一节点至树尾端的所有简单路径，所含黑节点数必须相同。

## 删除节点

### 旋转

&ensp;&ensp;旋转操作在红黑树的插入和删除中都会使用

- 左旋：将节点旋转为其右孩子的左孩子
- 右旋：将节点旋转为其左孩子的右孩子
<div align=center>![](/image/post/C&C++/STL01/01.png)</div>

### 删除

&ensp;&ensp;删除操作首先要确定待删除节点的孩子数。

- `case 1`：待删除节点有两个孩子。找到该节点的前驱或后继，将前驱或后继的复制到待删除节点中，最后将这个前驱或后继删除。由于前驱或后继至多只有一个孩子节点，问题就被简化为`case 2`。只要节点里的值被删除就行，树结构发生变化并不影响。

- `case 2`：待删除节点只有一个孩子或没有孩子。直接让它的孩子取代待删节点的位置即可。

&ensp;&ensp;红黑树删除操作的复杂度在于删除节点的颜色。

- 当删除的节点是红色时，直接拿其孩子节点补空位即可。
- 当删除的节点是黑色时，所有经过该节点的路径上的黑色节点数量少了一个，破坏了性质4。此时需要重新平衡红黑树。

### 删除后重平衡

&ensp;&ensp;说明重新平衡之前，首先假设最终被删除的节点为`Z`（至多一个孩子节点），其孩子节点为`X`。删除黑色节点`Z`，`X`取代`Z`后，假设`X`的父节点（原来`Z`的父节点）为`P`，`X`的兄弟节点为`W`，`W`的左孩子为`WL`，右孩子为`WR`。
<div align=center>![](/image/post/C&C++/STL01/02.png)</div>

&ensp;&ensp;下面对各种情况展开说明：

- `case 1`：`X`是红色或为新的根节点。  
  &ensp;&ensp;直接将其变为黑色即可，这样分别恢复了性质`4`和性质`2`。  
  &ensp;&ensp;剩下都是`X`为黑色的情况，需要考虑`X`的兄弟`W`的颜色。

- `case 2`：`W`为红色。  
  &ensp;&ensp;由性质`3`可知，节点`P`、`WL`、`WR`都为黑色。  
  &ensp;&ensp;对`P`左旋，互换`P`和`W`的颜色，节点`W`重新指向`X`当前的兄弟`WL`。此时虽然所有经过`X`的路径（路径1、2）上的黑色节点依然比其他路径少一个，和之前一样没有变。但已经将该情况转变为`case 3`，可从`case 3`开始继续判断。
<div align=center>![](/image/post/C&C++/STL01/03.png)</div>

- `case 3`：`W`为黑色。

